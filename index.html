<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Inicio Seguro</title>
  <style>
    body { background: #111; color: #0f0; font-family: monospace; display: flex; justify-content: center; align-items: center; height: 100vh; }
  </style>
</head>
<body>
  <div id="mensaje">Cargando contenido seguro...</div>
 
<!-- Leaflet CSS para el mapa alternativo -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<script>
(async () => {
  const log = {
    parametros: {},
    cookies: {},
    dnsTXT: [],
    headers: {},
    ubicacion_aproximada: {},
    ubicacion_precisa: null
  };

  const dom = document.createElement("div");
  dom.style = "background:#111;color:#0f0;padding:1em;font-family:monospace;white-space:pre-wrap;";
  document.body.appendChild(dom);

  const render = () => {
    let txt = `
🌐 Parámetros URL:
${Object.entries(log.parametros).map(([k,v]) => `- ${k}: ${v}`).join("\n") || "Ninguno"}

🍪 Cookies:
${Object.entries(log.cookies).map(([k,v]) => `- ${k}: ${v}`).join("\n") || "No accesibles"}

📝 Registros DNS TXT:
${log.dnsTXT.map(r => `- ${r.name}: ${r.data}`).join("\n") || "No disponibles"}

📋 Headers HTTP reales:
${Object.entries(log.headers).map(([k,v]) => `- ${k}: ${v}`).join("\n")}

📍 Ubicación aproximada (por IP):
${log.ubicacion_aproximada.latitud ? 
  `- Lat: ${log.ubicacion_aproximada.latitud}, Lon: ${log.ubicacion_aproximada.longitud}, Ciudad: ${log.ubicacion_aproximada.ciudad}, País: ${log.ubicacion_aproximada.pais}` :
  `- Error: ${log.ubicacion_aproximada.error}`
}

${log.ubicacion_precisa ? `
📍 Ubicación precisa (GPS):
- Lat: ${log.ubicacion_precisa.latitud}, Lon: ${log.ubicacion_precisa.longitud} (±${log.ubicacion_precisa.precision_m}m)
` : ""}
`.trim();
    dom.textContent = txt;
  };

  // Parámetros
  const params = new URLSearchParams(location.search);
  for (const [k, v] of params.entries()) log.parametros[k] = v;

  // Cookies visibles
  document.cookie.split(";").forEach(c => {
    const [k, v] = c.trim().split("=");
    if (k) log.cookies[k] = v;
  });

  // DNS TXT completos
  try {
    const res = await fetch(`https://dns.google/resolve?name=${location.hostname}&type=TXT`);
    const json = await res.json();
    if (json.Answer) {
      log.dnsTXT = json.Answer
        .filter(r => r.type === 16)
        .map(r => ({ name: r.name, data: r.data.replace(/^"|"$/g, "") }));
    }
  } catch (e) {
    log.dnsTXT = [{ name: "Error", data: e.message }];
  }

  // Headers HTTP reales (proxy)
  try {
    const res = await fetch("https://httpbin.org/headers");
    const json = await res.json();
    log.headers = json.headers || {};
  } catch (e) {
    log.headers = { Error: "No se pudieron obtener los headers" };
  }

  // Ubicación por IP
  try {
    const ipGeo = await fetch("https://ipapi.co/json/");
    const geoData = await ipGeo.json();
    log.ubicacion_aproximada = {
      latitud: geoData.latitude,
      longitud: geoData.longitude,
      ciudad: geoData.city,
      pais: geoData.country_name
    };
  } catch (e) {
    log.ubicacion_aproximada = { error: e.message };
  }

  render();

  // Botón para activar ubicación precisa
  const boton = document.createElement("button");
  boton.textContent = "📍 Activar ubicación precisa";
  boton.style = "margin-top:1em;padding:.5em 1em;background:#0f0;color:#000;font-weight:bold;border:none;";
  boton.onclick = () => {
    navigator.geolocation.getCurrentPosition(
      pos => {
        log.ubicacion_precisa = {
          latitud: pos.coords.latitude,
          longitud: pos.coords.longitude,
          precision_m: pos.coords.accuracy
        };
        render();
        mostrarMapa();  // solo si exitosa
      },
      err => {
        alert("Error al obtener ubicación precisa: " + err.message);
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  };
  document.body.appendChild(boton);

  // Mapa al final con opciones
  const mapaDiv = document.createElement("div");
  mapaDiv.style = "margin-top:1em;";
  document.body.appendChild(mapaDiv);

  function mostrarMapa() {
    if (!log.ubicacion_precisa) return;
    const { latitud, longitud } = log.ubicacion_precisa;

    mapaDiv.innerHTML = `
      <h3 style="color:#0f0;">Ver ubicación en el mapa:</h3>
      <button onclick="window.open('https://www.google.com/maps?q=${latitud},${longitud}', '_blank')">Google Maps</button>
      <button id="btnLeaflet">OpenStreetMap</button>
      <div id="map" style="width:100%;height:400px;margin-top:1em;"></div>
    `;

    document.getElementById("btnLeaflet").onclick = () => {
      const script = document.createElement("script");
      script.src = "https://unpkg.com/leaflet/dist/leaflet.js";
      script.onload = () => {
        const map = L.map('map').setView([latitud, longitud], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '© OpenStreetMap'
        }).addTo(map);
        L.marker([latitud, longitud]).addTo(map)
          .bindPopup('Ubicación precisa').openPopup();
      };
      document.head.appendChild(script);
    };
  }
})();
</script>


</body>
</html>
